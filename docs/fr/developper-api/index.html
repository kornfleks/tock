<!doctype html><html lang="fr" class="no-js"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="description" content="Pour construire aisément vos prochains bots"><link rel="canonical" href="https://voyages-sncf-technologies.github.io/tock/fr/developper-api/"><meta name="author" content="VSCT"><meta name="lang:clipboard.copy" content="Copier dans le presse-papier"><meta name="lang:clipboard.copied" content="Copié dans le presse-papier"><meta name="lang:search.language" content="fr"><meta name="lang:search.pipeline.stopwords" content="True"><meta name="lang:search.pipeline.trimmer" content="True"><meta name="lang:search.result.none" content="Aucun document trouvé"><meta name="lang:search.result.one" content="1 document trouvé"><meta name="lang:search.result.other" content="# documents trouvés"><meta name="lang:search.tokenizer" content="[\s\-]+"><link rel="shortcut icon" href="../img/favicon.png"><meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.3.1"><title>Développer via API - Tock</title><link rel="stylesheet" href="../assets/stylesheets/application.4031d38b.css"><script src="../assets/javascripts/modernizr.74668098.js"></script><link href="https://fonts.gstatic.com" rel="preconnect" crossorigin><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=swap"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel="stylesheet" href="../assets/fonts/material-icons.css"></head><body dir="ltr"><svg class="md-svg"><defs><svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg></defs></svg> <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off"> <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off"> <label class="md-overlay" data-md-component="overlay" for="__drawer"></label><a href="#developper-un-assistant-via-api-beta" tabindex="1" class="md-skip">Skip to content </a><header class="md-header" data-md-component="header"><nav class="md-header-nav md-grid"><div class="md-flex"><div class="md-flex__cell md-flex__cell--shrink"><a href="https://voyages-sncf-technologies.github.io/tock/fr" title="Tock" class="md-header-nav__button md-logo"><img src="../assets/images/logo.svg" width="24" height="24"></a></div><div class="md-flex__cell md-flex__cell--shrink"><label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label></div><div class="md-flex__cell md-flex__cell--stretch"><div class="md-flex__ellipsis md-header-nav__title" data-md-component="title"><span class="md-header-nav__topic">Tock</span><span class="md-header-nav__topic">Développer via API</span></div></div><div class="md-flex__cell md-flex__cell--shrink"><label class="md-icon md-icon--search md-header-nav__button" for="__search"></label><div class="md-search" data-md-component="search" role="dialog"><label class="md-search__overlay" for="__search"></label><div class="md-search__inner" role="search"><form class="md-search__form" name="search"><input type="text" class="md-search__input" name="query" placeholder="Rechercher" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active"> <label class="md-icon md-search__icon" for="__search"></label> <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button></form><div class="md-search__output"><div class="md-search__scrollwrap" data-md-scrollfix><div class="md-search-result" data-md-component="result"><div class="md-search-result__meta">Taper pour démarrer la recherche</div><ol class="md-search-result__list"></ol></div></div></div></div></div></div><div class="md-flex__cell md-flex__cell--shrink"><div class="md-header-nav__source"><a href="https://github.com/voyages-sncf-technologies/tock" title="Aller au dépôt" class="md-source" data-md-source="github"><div class="md-source__icon"><svg viewBox="0 0 24 24" width="24" height="24"><use xlink:href="#__github" width="24" height="24"></use></svg></div><div class="md-source__repository">tock</div></a></div></div></div></nav></header><div class="md-container"><main class="md-main"><div class="md-main__inner md-grid" data-md-component="container"><div class="md-sidebar md-sidebar--primary" data-md-component="navigation"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav class="md-nav md-nav--primary" data-md-level="0"><label class="md-nav__title md-nav__title--site" for="__drawer"><a href="https://voyages-sncf-technologies.github.io/tock/fr" title="Tock" class="md-nav__button md-logo"><img src="../assets/images/logo.svg" width="48" height="48"></a>Tock</label><div class="md-nav__source"><a href="https://github.com/voyages-sncf-technologies/tock" title="Aller au dépôt" class="md-source" data-md-source="github"><div class="md-source__icon"><svg viewBox="0 0 24 24" width="24" height="24"><use xlink:href="#__github" width="24" height="24"></use></svg></div><div class="md-source__repository">tock</div></a></div><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href=".." title="Présentation" class="md-nav__link">Présentation</a></li><li class="md-nav__item"><a href="../pour-commencer/" title="Pour commencer" class="md-nav__link">Pour commencer</a></li><li class="md-nav__item"><a href="../construire-le-modele/" title="Construire le modèle" class="md-nav__link">Construire le modèle</a></li><li class="md-nav__item"><a href="../evaluer-la-pertinence-du-modele/" title="Evaluer la pertinence du modèle" class="md-nav__link">Evaluer la pertinence du modèle</a></li><li class="md-nav__item"><a href="../developper-un-assistant/" title="Développer un Assistant" class="md-nav__link">Développer un Assistant</a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6"><label class="md-nav__link" for="nav-6">Assistant Tock</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-6">Assistant Tock</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../presentation-du-bot-open-data/" title="Présentation du Bot Open Data" class="md-nav__link">Présentation du Bot Open Data</a></li><li class="md-nav__item"><a href="../developper/" title="Développer" class="md-nav__link">Développer</a></li><li class="md-nav__item"><a href="../tester/" title="Tester" class="md-nav__link">Tester</a></li></ul></nav></li><li class="md-nav__item md-nav__item--active md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" checked><label class="md-nav__link" for="nav-7">Assistant via API</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-7">Assistant via API</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item md-nav__item--active"><input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc"><label class="md-nav__link md-nav__link--active" for="__toc">Développer via API</label><a href="./" title="Développer via API" class="md-nav__link md-nav__link--active">Développer via API</a><nav class="md-nav md-nav--secondary"><label class="md-nav__title" for="__toc">Table des matières</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="#client-kotlin" title="Client Kotlin" class="md-nav__link">Client Kotlin</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#websocket" title="Websocket" class="md-nav__link">Websocket</a></li><li class="md-nav__item"><a href="#webhook" title="Webhook" class="md-nav__link">Webhook</a></li><li class="md-nav__item"><a href="#recuperation-de-la-cle-de-lapi" title="Récupération de la clé de l'API" class="md-nav__link">Récupération de la clé de l'API</a></li><li class="md-nav__item"><a href="#premiere-version-de-lassistant" title="Première version de l'Assistant" class="md-nav__link">Première version de l'Assistant</a></li></ul></nav></li><li class="md-nav__item"><a href="#se-connecter-a-lapi-directement" title="Se connecter à l'API directement" class="md-nav__link">Se connecter à l'API directement</a></li></ul></nav></li></ul></nav></li><li class="md-nav__item"><a href="../i18n/" title="i18n" class="md-nav__link">i18n</a></li><li class="md-nav__item"><a href="../api/" title="APIs de Tock" class="md-nav__link">APIs de Tock</a></li><li class="md-nav__item"><a href="../kdoc/" title="KDoc" class="md-nav__link">KDoc</a></li><li class="md-nav__item"><a href="../contribuer/" title="Contribuer au projet" class="md-nav__link">Contribuer au projet</a></li><li class="md-nav__item"><a href="../installation/" title="Installation de Tock" class="md-nav__link">Installation de Tock</a></li></ul></nav></div></div></div><div class="md-sidebar md-sidebar--secondary" data-md-component="toc"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav class="md-nav md-nav--secondary"><label class="md-nav__title" for="__toc">Table des matières</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="#client-kotlin" title="Client Kotlin" class="md-nav__link">Client Kotlin</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#websocket" title="Websocket" class="md-nav__link">Websocket</a></li><li class="md-nav__item"><a href="#webhook" title="Webhook" class="md-nav__link">Webhook</a></li><li class="md-nav__item"><a href="#recuperation-de-la-cle-de-lapi" title="Récupération de la clé de l'API" class="md-nav__link">Récupération de la clé de l'API</a></li><li class="md-nav__item"><a href="#premiere-version-de-lassistant" title="Première version de l'Assistant" class="md-nav__link">Première version de l'Assistant</a></li></ul></nav></li><li class="md-nav__item"><a href="#se-connecter-a-lapi-directement" title="Se connecter à l'API directement" class="md-nav__link">Se connecter à l'API directement</a></li></ul></nav></div></div></div><div class="md-content"><article class="md-content__inner md-typeset"><h1 id="developper-un-assistant-via-api-beta">Développer un Assistant via API (béta)<a class="headerlink" href="#developper-un-assistant-via-api-beta" title="Permanent link">&para;</a></h1>
<p>Une API est mise à disposition pour développer un Assistant.
Les fonctionnalités sont aujourd'hui limitées par rapport au mode "Assistant Tock"
 mais ont vocation à être étendues rapidement.</p>
<p>Il est possible d'utiliser cette API de deux manières :</p>
<ul>
<li>En utilisant le client Kotlin mis à disposition</li>
<li>En se connectant à l'API dans un autre langage</li>
</ul>
<h2 id="client-kotlin">Client Kotlin<a class="headerlink" href="#client-kotlin" title="Permanent link">&para;</a></h2>
<h3 id="websocket">Websocket<a class="headerlink" href="#websocket" title="Permanent link">&para;</a></h3>
<p>La version à privilégier au démarrage est la version utilisant les websockets.</p>
<p>Pour utiliser le client websocket, il faut ajouter la dépendance <em>tock-bot-api-websocket</em> à votre projet.</p>
<p>Avec Maven :</p>
<div class="codehilite"><pre><span></span>        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>fr.vsct.tock<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>tock-bot-api-websocket<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>19.3.2-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
</pre></div>


<p>ou Gradle :</p>
<div class="codehilite"><pre><span></span>      <span class="n">compile</span> <span class="s1">&#39;fr.vsct.tock:tock-bot-api-websocket:19.3.2-SNAPSHOT&#39;</span>
</pre></div>


<h3 id="webhook">Webhook<a class="headerlink" href="#webhook" title="Permanent link">&para;</a></h3>
<p>Pour utiliser le client webhook, il faut ajouter la dépendance <em>tock-bot-api-webhook</em> à votre projet.</p>
<p>Avec Maven :</p>
<div class="codehilite"><pre><span></span>        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>fr.vsct.tock<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>tock-bot-api-webhook<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>19.3.2-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
</pre></div>


<p>ou Gradle :</p>
<div class="codehilite"><pre><span></span>      <span class="n">compile</span> <span class="s1">&#39;fr.vsct.tock:tock-bot-api-webhook:19.3.2-SNAPSHOT&#39;</span>
</pre></div>


<p>Dans ce cas, contrairement au mode "websocket", 
il faut bien sûr que l'url du serveur démarré soit joignable par la stack docker Tock.
Cette url doit être indiquée dans le champ "webhook url" de la configuration choisie 
dans l'onglet Configuration -&gt; Bots Configurations.</p>
<h3 id="recuperation-de-la-cle-de-lapi">Récupération de la clé de l'API<a class="headerlink" href="#recuperation-de-la-cle-de-lapi" title="Permanent link">&para;</a></h3>
<p>Aller dans Configuration -&gt; Bot Configurations et copiez/collez la clé de l'api
correspondant à la configuration sur laquelle vous souhaitez vous connecter.</p>
<h3 id="premiere-version-de-lassistant">Première version de l'Assistant<a class="headerlink" href="#premiere-version-de-lassistant" title="Permanent link">&para;</a></h3>
<p>Le toolkit mis à disposition supporte dans ses réponses le format text simple, le format "carte" et tous
les formats spécifiques aux différents canaux supportés.</p>
<p>Voici un exemple de Bot simple : </p>
<div class="codehilite"><pre><span></span><span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">start</span><span class="p">(</span>
        <span class="n">newBot</span><span class="p">(</span>
            <span class="c1">//clé de l&#39;API</span>
            <span class="s">&quot;4149823a-ac28-4a5d-9f3c-0e8f48a11865&quot;</span><span class="p">,</span>
            <span class="c1">//réponse simple ,correspondant à l&#39;intention greetings</span>
            <span class="n">newStory</span><span class="p">(</span><span class="s">&quot;greetings&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">end</span><span class="p">(</span><span class="s">&quot;Coucou&quot;</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="c1">//réponse sous format card correspondant à l&#39;intention location</span>
            <span class="n">newStory</span><span class="p">(</span><span class="s">&quot;location&quot;</span><span class="p">)</span> <span class="p">{</span>
                            <span class="n">end</span><span class="p">(</span>
                                <span class="n">newCard</span><span class="p">(</span>
                                    <span class="s">&quot;Titre&quot;</span><span class="p">,</span>
                                    <span class="s">&quot;Sous-Titre&quot;</span><span class="p">,</span>
                                    <span class="n">newAttachment</span><span class="p">(</span><span class="s">&quot;https://url-image.png&quot;</span><span class="p">),</span>
                                    <span class="n">newAction</span><span class="p">(</span><span class="s">&quot;Action 1&quot;</span><span class="p">),</span>
                                    <span class="n">newAction</span><span class="p">(</span><span class="s">&quot;Action 2&quot;</span><span class="p">,</span> <span class="s">&quot;http://redirection&quot;</span><span class="p">)</span>
                                <span class="p">)</span>
                            <span class="p">)</span>
                        <span class="p">}</span>
            <span class="c1">//réponse sous format spécifique au canal (ici messenger)</span>
            <span class="c1">//correspondant à l&#39;intention goodbye</span>
            <span class="n">newStory</span><span class="p">(</span><span class="s">&quot;goodbye&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">end</span> <span class="p">{</span>
                    <span class="n">buttonsTemplate</span><span class="p">(</span><span class="s">&quot;Mais pourquoi?&quot;</span><span class="p">,</span> <span class="n">nlpQuickReply</span><span class="p">(</span><span class="s">&quot;Je ne veux pas partir&quot;</span><span class="p">))</span>
                <span class="p">}</span> 
            <span class="p">}</span>                                                                
             <span class="c1">//réponse renvoyée quand l&#39;intention n&#39;est pas répertoriée  </span>
            <span class="n">unknownStory</span> <span class="p">{</span>
                <span class="n">end</span><span class="p">(</span><span class="s">&quot;je n&#39;ai pas compris&quot;</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">))</span>
<span class="p">}</span>
</pre></div>


<h2 id="se-connecter-a-lapi-directement">Se connecter à l'API directement<a class="headerlink" href="#se-connecter-a-lapi-directement" title="Permanent link">&para;</a></h2>
<p>Contrat API en cours de rédaction</p></article></div></div></main><footer class="md-footer"><div class="md-footer-nav"><nav class="md-footer-nav__inner md-grid"><a href="../tester/" title="Tester" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev"><div class="md-flex__cell md-flex__cell--shrink"><i class="md-icon md-icon--arrow-back md-footer-nav__button"></i></div><div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span class="md-flex__ellipsis"><span class="md-footer-nav__direction">Précédent</span>Tester</span></div></a><a href="../i18n/" title="i18n" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next"><div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span class="md-flex__ellipsis"><span class="md-footer-nav__direction">Suivant</span>i18n</span></div><div class="md-flex__cell md-flex__cell--shrink"><i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i></div></a></nav></div><div class="md-footer-meta md-typeset"><div class="md-footer-meta__inner md-grid"><div class="md-footer-copyright"><div class="md-footer-copyright__highlight">Copyright &copy; 2017/2019 VSCT</div>powered by <a href="https://www.mkdocs.org">MkDocs</a> and <a href="https://squidfunk.github.io/mkdocs-material/">Material for MkDocs</a></div><div class="md-footer-social"><link rel="stylesheet" href="../assets/fonts/font-awesome.css"> <a href="https://github.com/voyages-sncf-technologies/tock" class="md-footer-social__link fa fa-github"></a> </div></div></div></footer></div><script src="../assets/javascripts/application.b260a35d.js"></script><script src="../assets/javascripts/lunr/lunr.stemmer.support.js"></script><script src="../assets/javascripts/lunr/lunr.fr.js"></script><script>app.initialize({version:"1.0.4",url:{base:".."}})</script></body></html>